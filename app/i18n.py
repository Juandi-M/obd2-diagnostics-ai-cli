from __future__ import annotations

from typing import Dict

LANGUAGE_NAMES: Dict[str, str] = {
    "en": "English",
    "es": "Español",
}

LANGUAGES: Dict[str, Dict[str, str]] = {
    "en": {
        "app_name": "OBD-II Scanner",
        "main_menu": "MAIN MENU",
        "connect": "Connect to Vehicle",
        "disconnect": "Disconnect",
        "full_scan": "Full Diagnostic Scan",
        "read_codes": "Read Trouble Codes",
        "live_monitor": "Live Telemetry Monitor",
        "freeze_frame": "Freeze Frame Data",
        "readiness": "Readiness Monitors",
        "clear_codes": "Clear Codes",
        "lookup": "Lookup Code",
        "search": "Search Codes",
        "uds_tools": "UDS Tools",
        "ai_report": "AI Diagnostic Report",
        "settings": "Settings",
        "exit": "Exit",
        "back": "Back",
        "status": "Status",
        "connected": "Connected",
        "disconnected": "Disconnected",
        "vehicle": "Vehicle",
        "format": "Format",
        "language": "Language",
        "select_option": "Select option",
        "press_enter": "Press Enter to continue...",
        "confirm_yes_no": "Continue? (y/n)",
        "type_yes": "Type 'YES' to confirm",
        "cancelled": "Cancelled.",
        "connect_header": "CONNECT TO VEHICLE",
        "already_connected": "Already connected!",
        "disconnect_reconnect": "Disconnect and reconnect?",
        "searching_adapter": "Searching for OBD adapter...",
        "found_ports": "Found {count} port(s)",
        "trying_port": "Trying {port}...",
        "connected_on": "Connected on {port}",
        "connection_failed": "Failed: {error}",
        "no_ports_found": "No USB serial ports found!",
        "adapter_tip": "Make sure your ELM327 is plugged in.",
        "no_vehicle_response": "Could not connect to any vehicle.",
        "disconnected_at": "Disconnected at {time}",
        "scan_header": "FULL DIAGNOSTIC SCAN",
        "report_time": "Report Time",
        "vehicle_connection": "VEHICLE CONNECTION",
        "elm_version": "ELM327 Version",
        "protocol": "Protocol",
        "mil_status": "MIL (Check Engine)",
        "dtc_count": "DTC Count",
        "dtc_header": "DIAGNOSTIC TROUBLE CODES",
        "no_codes": "No trouble codes stored",
        "code_lookup_header": "CODE LOOKUP",
        "enter_code": "Enter code (e.g., P0118)",
        "code_not_found": "Code '{code}' not found in database.",
        "similar_codes": "Similar codes:",
        "search_header": "SEARCH CODES",
        "search_prompt": "Search term (e.g., 'throttle', 'coolant')",
        "found_codes": "Found {count} codes:",
        "no_codes_found": "No codes found matching '{query}'",
        "codes_loaded": "codes loaded",
        "manufacturer": "Manufacturer",
        "source": "Source",
        "live_header": "LIVE SENSOR DATA",
        "live_telemetry": "LIVE TELEMETRY",
        "started": "Started",
        "refresh": "Refresh",
        "press_ctrl_c": "Press Ctrl+C to stop",
        "save_log_prompt": "Save to log file?",
        "logging_to": "Logging to",
        "time": "Time",
        "on": "On",
        "off": "Off",
        "coolant": "Coolant",
        "speed": "Speed",
        "throttle": "Throttle",
        "pedal": "Pedal",
        "volts": "Volts",
        "freeze_header": "FREEZE FRAME DATA",
        "no_freeze_data": "No freeze frame data available.",
        "freeze_tip": "(Freeze frames are captured when a DTC is stored)",
        "dtc_triggered": "DTC that triggered",
        "readiness_header": "READINESS MONITORS",
        "unable_read_readiness": "Unable to read readiness monitors.",
        "complete": "Complete",
        "incomplete": "Incomplete",
        "not_available": "Not Available",
        "summary": "Summary",
        "readiness_tip": "Incomplete monitors need drive cycles to complete.",
        "readiness_tip2": "Normal after clearing codes or disconnecting battery.",
        "clear_header": "CLEAR TROUBLE CODES",
        "clear_warning": "WARNING: This will:",
        "clear_warn1": "Erase stored trouble codes",
        "clear_warn2": "Turn off the Check Engine light",
        "clear_warn3": "Reset readiness monitors",
        "clear_warn4": "Remove freeze frame data",
        "clear_success": "Cleared successfully at {time}",
        "clear_failed": "Failed to clear codes.",
        "warning_high_temp": "WARNING: High coolant temp!",
        "warning_low_temp": "WARNING: Coolant temp is low.",
        "warning_throttle": "Note: Throttle open while idle.",
        "session_summary": "Session summary",
        "file": "File",
        "duration": "Duration",
        "seconds": "seconds",
        "readings": "Readings",
        "current_interval": "Current interval: {value}s",
        "new_interval": "New interval (0.5-10s)",
        "interval_set": "Interval set to {value}s",
        "invalid_range": "Invalid range.",
        "invalid_number": "Invalid number.",
        "available_ports": "Available ports",
        "no_ports": "No ports detected.",
        "log_format": "Log format",
        "log_formats": "Log formats",
        "csv_desc": "CSV (spreadsheet)",
        "json_desc": "JSON (structured)",
        "monitor_interval": "Monitor interval",
        "view_ports": "View ports",
        "set_to": "Set to {value}",
        "loaded_codes": "Loaded {count} codes",
        "settings_header": "SETTINGS",
        "vehicle_make": "Vehicle make",
        "available_manufacturers": "Available manufacturers",
        "select_manufacturer": "Select manufacturer",
        "select_language": "Select language",
        "select_brand": "Select brand",
        "brand_header": "SELECT VEHICLE BRAND",
        "generic_all": "Generic (all makes)",
        "demo_mode": "DEMO MODE",
        "demo_intro": "This demonstrates scanner features without hardware.",
        "demo_tip1": "Connect an ELM327 adapter to your vehicle.",
        "demo_tip2": "Turn ignition ON (or start engine).",
        "demo_tip3": "Run: python3 obd_scan.py",
        "demo_tip4": "Select option 1 to connect.",
        "goodbye": "Goodbye!",
        "not_connected": "Not connected to vehicle.",
        "error": "Error",
        "device_disconnected": "Device disconnected!",
        "uds_header": "UDS TOOLS",
        "uds_brand": "UDS brand",
        "uds_select_brand": "Select UDS brand",
        "uds_module": "UDS module",
        "uds_select_module": "Select module",
        "uds_menu": "UDS MENU",
        "uds_read_vin": "Read VIN (F190)",
        "uds_read_did": "Read DID",
        "uds_send_raw": "Send raw request",
        "uds_response": "Response",
        "uds_no_module": "No module selected.",
        "uds_service_id": "Service ID (hex)",
        "uds_data_hex": "Data (hex)",
        "ai_report_header": "AI DIAGNOSTIC REPORT",
        "ai_report_stub": "AI report generation is not implemented yet.",
        "language_header": "SELECT LANGUAGE",
    },
    "es": {
        "app_name": "Escáner OBD-II",
        "main_menu": "MENÚ PRINCIPAL",
        "connect": "Conectar al vehículo",
        "disconnect": "Desconectar",
        "full_scan": "Escaneo diagnóstico completo",
        "read_codes": "Leer códigos de falla",
        "live_monitor": "Monitor de telemetría en vivo",
        "freeze_frame": "Datos de congelación",
        "readiness": "Monitores de preparación",
        "clear_codes": "Borrar códigos",
        "lookup": "Buscar código",
        "search": "Buscar códigos",
        "uds_tools": "Herramientas UDS",
        "ai_report": "Informe diagnóstico IA",
        "settings": "Configuración",
        "exit": "Salir",
        "back": "Volver",
        "status": "Estado",
        "connected": "Conectado",
        "disconnected": "Desconectado",
        "vehicle": "Vehículo",
        "format": "Formato",
        "language": "Idioma",
        "select_option": "Selecciona opción",
        "press_enter": "Presiona Enter para continuar...",
        "confirm_yes_no": "¿Continuar? (s/n)",
        "type_yes": "Escribe 'SI' para confirmar",
        "cancelled": "Cancelado.",
        "connect_header": "CONECTAR AL VEHÍCULO",
        "already_connected": "¡Ya está conectado!",
        "disconnect_reconnect": "¿Desconectar y reconectar?",
        "searching_adapter": "Buscando adaptador OBD...",
        "found_ports": "Se encontraron {count} puerto(s)",
        "trying_port": "Probando {port}...",
        "connected_on": "Conectado en {port}",
        "connection_failed": "Falló: {error}",
        "no_ports_found": "¡No se encontraron puertos USB!",
        "adapter_tip": "Asegúrate de que el ELM327 esté conectado.",
        "no_vehicle_response": "No se pudo conectar con el vehículo.",
        "disconnected_at": "Desconectado a las {time}",
        "scan_header": "ESCANEO DIAGNÓSTICO COMPLETO",
        "report_time": "Hora del reporte",
        "vehicle_connection": "CONEXIÓN DEL VEHÍCULO",
        "elm_version": "Versión ELM327",
        "protocol": "Protocolo",
        "mil_status": "MIL (Check Engine)",
        "dtc_count": "Cantidad de DTC",
        "dtc_header": "CÓDIGOS DE FALLA",
        "no_codes": "No hay códigos almacenados",
        "code_lookup_header": "BÚSQUEDA DE CÓDIGO",
        "enter_code": "Ingresa código (ej., P0118)",
        "code_not_found": "El código '{code}' no está en la base de datos.",
        "similar_codes": "Códigos similares:",
        "search_header": "BUSCAR CÓDIGOS",
        "search_prompt": "Término de búsqueda (ej., 'throttle')",
        "found_codes": "Se encontraron {count} códigos:",
        "no_codes_found": "No se encontraron códigos para '{query}'",
        "codes_loaded": "códigos cargados",
        "manufacturer": "Fabricante",
        "source": "Fuente",
        "live_header": "DATOS EN VIVO",
        "live_telemetry": "TELEMETRÍA EN VIVO",
        "started": "Iniciado",
        "refresh": "Actualización",
        "press_ctrl_c": "Presiona Ctrl+C para detener",
        "save_log_prompt": "¿Guardar en archivo de registro?",
        "logging_to": "Guardando en",
        "time": "Hora",
        "on": "Encendido",
        "off": "Apagado",
        "coolant": "Refrigerante",
        "speed": "Velocidad",
        "throttle": "Acelerador",
        "pedal": "Pedal",
        "volts": "Voltios",
        "freeze_header": "DATOS DE CONGELACIÓN",
        "no_freeze_data": "No hay datos de congelación.",
        "freeze_tip": "(Los datos se capturan cuando se guarda un DTC)",
        "dtc_triggered": "DTC que disparó",
        "readiness_header": "MONITORES DE PREPARACIÓN",
        "unable_read_readiness": "No se pudo leer la preparación.",
        "complete": "Completo",
        "incomplete": "Incompleto",
        "not_available": "No disponible",
        "summary": "Resumen",
        "readiness_tip": "Los monitores incompletos requieren ciclos de conducción.",
        "readiness_tip2": "Es normal tras borrar códigos o desconectar batería.",
        "clear_header": "BORRAR CÓDIGOS",
        "clear_warning": "ADVERTENCIA: Esto hará:",
        "clear_warn1": "Borrar códigos almacenados",
        "clear_warn2": "Apagar la luz Check Engine",
        "clear_warn3": "Reiniciar monitores de preparación",
        "clear_warn4": "Eliminar datos de congelación",
        "clear_success": "Borrado exitoso a las {time}",
        "clear_failed": "No se pudieron borrar los códigos.",
        "warning_high_temp": "ADVERTENCIA: Temperatura alta!",
        "warning_low_temp": "ADVERTENCIA: Temperatura baja.",
        "warning_throttle": "Nota: Acelerador abierto en ralentí.",
        "session_summary": "Resumen de sesión",
        "file": "Archivo",
        "duration": "Duración",
        "seconds": "segundos",
        "readings": "Lecturas",
        "current_interval": "Intervalo actual: {value}s",
        "new_interval": "Nuevo intervalo (0.5-10s)",
        "interval_set": "Intervalo ajustado a {value}s",
        "invalid_range": "Rango inválido.",
        "invalid_number": "Número inválido.",
        "available_ports": "Puertos disponibles",
        "no_ports": "No se detectaron puertos.",
        "log_format": "Formato de registro",
        "log_formats": "Formatos de registro",
        "csv_desc": "CSV (hoja de cálculo)",
        "json_desc": "JSON (estructurado)",
        "monitor_interval": "Intervalo de monitoreo",
        "view_ports": "Ver puertos",
        "set_to": "Ajustado a {value}",
        "loaded_codes": "{count} códigos cargados",
        "settings_header": "CONFIGURACIÓN",
        "vehicle_make": "Marca de vehículo",
        "available_manufacturers": "Marcas disponibles",
        "select_manufacturer": "Selecciona fabricante",
        "select_language": "Selecciona idioma",
        "select_brand": "Selecciona marca",
        "brand_header": "SELECCIONA MARCA DEL VEHÍCULO",
        "generic_all": "Genérico (todas las marcas)",
        "demo_mode": "MODO DEMO",
        "demo_intro": "Esto muestra funciones sin hardware.",
        "demo_tip1": "Conecta un adaptador ELM327 al vehículo.",
        "demo_tip2": "Enciende el contacto (o el motor).",
        "demo_tip3": "Ejecuta: python3 obd_scan.py",
        "demo_tip4": "Selecciona la opción 1 para conectar.",
        "goodbye": "¡Adiós!",
        "not_connected": "No conectado al vehículo.",
        "error": "Error",
        "device_disconnected": "Dispositivo desconectado.",
        "uds_header": "HERRAMIENTAS UDS",
        "uds_brand": "Marca UDS",
        "uds_select_brand": "Selecciona marca UDS",
        "uds_module": "Módulo UDS",
        "uds_select_module": "Selecciona módulo",
        "uds_menu": "MENÚ UDS",
        "uds_read_vin": "Leer VIN (F190)",
        "uds_read_did": "Leer DID",
        "uds_send_raw": "Enviar solicitud cruda",
        "uds_response": "Respuesta",
        "uds_no_module": "No se seleccionó módulo.",
        "uds_service_id": "ID de servicio (hex)",
        "uds_data_hex": "Datos (hex)",
        "ai_report_header": "INFORME DIAGNÓSTICO IA",
        "ai_report_stub": "La generación de informes IA no está implementada.",
        "language_header": "SELECCIONA IDIOMA",
    },
}

_current_language = "en"


def set_language(code: str) -> bool:
    global _current_language
    if code in LANGUAGES:
        _current_language = code
        return True
    return False


def get_language() -> str:
    return _current_language


def get_language_name(code: str) -> str:
    return LANGUAGE_NAMES.get(code, code)


def get_available_languages() -> Dict[str, str]:
    return dict(LANGUAGE_NAMES)


def t(key: str, **kwargs: str) -> str:
    lang_table = LANGUAGES.get(_current_language, LANGUAGES["en"])
    text = lang_table.get(key) or LANGUAGES["en"].get(key) or key
    if kwargs:
        return text.format(**kwargs)
    return text
